单个回车
视为空格

连续回车

视为换行

行尾两个空格  
即为段内换行


*斜体*
**粗体**
:coffee:
>引用

# 大标题

## 小标题

# 对加密数据进行任意函数运算
## 摘要
假设你想要让别人来处理数据，但是又不想让别人接触到你的数据。我们已经知道，这样做是可能的：我们描述了一个“完全同态”加密方案，可以保持数据的私有性。即使当函数非常复杂的时候，还可以让一个不具有解密密钥的工作人员来对数据的任何（仍然加密）的结果进行运算。总之,第三者能够执行复杂的数据处理，而不用看到它。别的不说，这有助于使云计算兼容隐私。
## 1. 介绍
是否有可能让别人来处理数据，但是又不让这个人接触到你的数据？

这个问题，考验了方便与隐私之间的关系，所以一直是很重要的，但似乎尤其是现在，我们正在广泛使用云计算。把一切东西都未加密地存放“在云中”，是冒着很大风险的。对于某些类型的数据,如医疗记录、离线加密存储它们可能是非法的。另一方面,加密的数据似乎取消云计算的好处。除非我给云我的秘密解密密钥(牺牲我的隐私),我能期望云能对我的加密数据做什么，除了把它送还给我让我自己解密并进行运算？

幸运的是,这是一个错误的困境,或者至少方便和隐私可以在很大程度上同时得到满足。对于一个“普通”加密的数据,几乎不可能有人没有解密密钥(比如云)来使用任何有用的方法操作基础数据。然而,一些同态加密方案，他们让任何人操作(以一种有意义的方式)加密数据,甚至不知道密钥!

在本文中,我们描述的第一种完全同态加密(FHE)方案,意味着“完全”
没有限制可以执行哪些操作。给定一组密文**c1,…,ct**加密**m1,…,mt**，它们已经使用了我们的全同态加密方案和秘钥进行加密。再给定任何有效的可计算的函数f,任何人都可以有效地计算出一个密文(或一组密文)，它是**f(m1,…,mt)** 在那个秘钥下加密的结果。简而言之,这允许通用计算加密的数据。没有任何关于**m1,…,mt**的信息或**f(m1,…,mt)** 的值会被泄露。

>以下的英文字符和公式在定稿时都需要更改，只有中文不用更改，还请注意符号，如括号

这意味着云计算与隐私保护是一致的。如果我想要我的云对我的（加密）数据m1,…,mt计算某些函数**f**。例如,这个函数可以是“包含'CACM'的所有文件”或“包含‘ACM’三个字的所有通讯”-我发送对函数f的描述到云,它使用这个方案来计算一个加密的f(m1,…,mt)。云永远不会看到任何未加密的数据。如果我想要,我甚至可以使用加密的方案描述
f的,所以云甚至看不到我是寻找什么。

Rivest、Adleman和Dertouzos表示完全同态加密的实现可能在1978年,RSA密码系统的发明不久后,但却很难找到一个安全的方案。作为一个应用程序中,他们描述了我们
私有云计算场景,当然他们使用不同的术语。除此之外，还有许多其他应用程序。只要一个加密的响应是可接受的，那么同态加密久是有用的(如。搜索引擎查询)。

下面,我们首先描述同态加密更多细节。然后,我们描述一个具体的方案。这个方案是来自Van Dijk,Gentry,Halevi和Vaikuntanathan,它只使用简单的整数操作,是Gentry使用格的方案的概念简化版本。最后,我们讨论了方案(很慢)的性能。我们为了使这个方案更加形象化，进行了这样的类比:爱丽丝，一家珠宝店老板,想要她的工人把珍贵原料制作成精心设计的戒指和项链,但是她又害怕她的工人因为可以接触原料而偷取它们。

## 2. 同态加密
### 2.1. 爱丽丝的珠宝店
首先,处理数据而无需访问它的概念似乎是矛盾的,甚至在逻辑上是不可能的。为了说服你这是没有漏洞的,让我们在(虚构版本的)的“物理世界”里考虑一个类似的问题。爱丽丝拥有一家珠宝店。她的珍贵原料有——黄金,钻石,银等等。她希望工人来制作精美设计的戒指和项链。但她不信任工人并且假设如果有机会他们会抢了她的珠宝。换句话说,她希望自己的工人把材料加工成成品,但是爱丽丝不允许他们触碰材料。她应该怎么做?

这是她的方案。她用一个透明的无法穿透的手套箱,配上一个只有她有钥匙的锁。她把珍贵的原料存放在盒子里面,锁上它,把它交给一个工人。使用手套,工人在盒内制作戒指或项链。因为盒子是无法穿透的,工人无法取得珍贵的材料。所以他最后不得不制作完成后将成品存在盒子内还给爱丽丝，爱丽丝打开盒子，取出戒指或项链。简而言之,工人把原材料加工成成品,没有真正触碰材料。

锁上的密不透风的盒子,里面有着珍贵的原料,这代表了初始数据的加密m1,…,mt,只能通过秘钥访问。手套代表同态加密方案,原始数据可以在“加密盒”内被操作在。在盒子里面完成的戒指或项链代表f(m1,…,mt)的加密,所需要的对初始数据的进行操作的函数。注意,“缺乏”是指对珠宝缺乏物理访问,而不是缺乏视觉访问。(举个例子,处理照片的暗房就是使用了“缺乏视觉接触”。)

当然,爱丽丝的珠宝店只是一个比喻。它并不能完全解释同态加密的某些方面,也可能把它变得更令人困惑。我们在本节的最后，在我们正式地描述同态加密之后，讨论一些类比上的缺陷。尽管存在缺陷,但我们仍旧使用类比,因为它很好的说明了我们解决方案的某些方面，更重要的是，它非常好的解释了“自举”。

>加密方案e要改 四个算法分别有角标 注意逗号的统一 引用

### 2.2. 同态加密：功能
一个加密方案e有三个算法:KeyGen,Encrypt,Decrypt,所有这些都必须高效,运行在poly(namuta)的时间内。多项式的安全参数namuta指定了密钥的位长。在对称私钥加密方案中,KeyGen使用namuta生成一个同时使用在Encrypt和Decrypt中的密钥。首先将消息映射到密文,然后将密文映射回消息。在非对称、公钥加密方案中,KeyGene使用namuta生成两个密钥——一个是公钥pk,这是可以提供给每一个人的,和一个私钥sk。作为一个非对称加密方案的物理类比,可以把爱丽丝的公钥想象成挂锁,由她制造和分发,可以在没有钥匙的情况下锁上。任何人都可以把一条消存在一个盒子里，然后使用爱丽丝的挂锁(加密),然后通过公共频道将它邮寄给爱丽丝,但只有爱丽丝拥有解锁用的钥匙(Decrypt)。

同态加密方案可以是对称或不对称的,但我们将关注不对称的情况。它拥有第四个算法Evaluate,这是一组相关的容许函数。对于任何Fe中的函数f和暗文c1,…,ct(ci<-Encrypt(pk,mi)),该算法Evaluatee(pk,f,c1,…,ct)输出加密后的密文c(加密了f(m1,…,mt))。例如，这样Decrypte(sk,c)= f(m1,…,mt)。(为了方便起见,我们将假设f有一个输出。如果f有k个输出,那么Evaluatee输出k个暗文(对应加密f(m1,…,mt))。总的来说,方案e可以处理Fe中的所有函数。若函数f不在容许函数集合中,那么无法保证Evaluatee输出任何有意义的数据。

到目前为止,构造一个可以处理所有功能的加密方案的方法还不够明确。定义Evaluatee如下:简单输出c<-(f,c1,…,ct),没有“处理”暗文。修改Decrypte如下:解密c,解密c1,…,ct从而获得m1,…,mt,然后将函数f应用于这些消息。

但是这个简单的解决方案显然不符合我们的理想——实现委托数据处理(同时保持隐私)。简单的解决方案是,在爱丽丝的珠宝店,工人只需发送盒子(不需要手套)返还给爱丽丝珍贵原料，没有做任何工作,当爱丽丝打开盒子,提取材料,然后自己制作项链或戒指。

那么,我们如何使委托这个过程标准化?直观地说,委托的目的是减少工作量。我们可以看做算法的运行时间(即复杂度)。具体来说,我们要求解密c(由Evaluatee输出的密文)和解密c1(由Evaluatee输出的密文)的运算量相同。此外,我们要求c和c1大小一致。我们称这些为紧凑型暗文要求。此外,c的长度和解密所需的时间不会随f的复杂性增长;相反,它们是完全独立于f(除非f有多个输出)。当然,Decrypte的复杂度,以及KeyGene的复杂度和Encrypte的复杂度,必须保持在poly(namuta)。

e如果能处理所有函数,拥有紧凑的暗文,Evaluatee可以有效的工作,那么这个方案就是同态加密方案。上面的平凡解肯定不是完全同态,因为Evaluatee输出密文的大小,以及解密所需的时间,取决于函数。我们对完全同态的定义符合爱丽丝珠宝店的最佳情况:她的工人可以在盒子里随意组装复杂的材料,但是这个工作不需要爱丽丝来打开盒子并提取材料。

我们希望我们的完全同态方案是十分有效的,。特别是,我们希望的Evaluatee的复杂度在多项式上只依赖于安全参数。但显然其复杂度也必须依赖于函数。我们如何衡量f的复杂度?也许最明显的指标是计算f的图灵机运行时间Tf。任何函数可以在Tf步内在一个图灵机上完成都可以表示为一个有Tf个门的电路。更准确地说,对一些小常数k,Sf<k*Tf*logTf。总的来说,如果有一个多项式g,对于任何由大小为Sf电路表示的函数f,Evaluatee(pk,f,c1...ct)复杂度最大为Sf*g(namuta)，我们说Evaluatee是有效的。

f的电路表示也很有用,因为它把f的计算分解成简单的步骤——例如,与门，或门，非门。此外,为了评估这些门,它足以能够做加法、减法、和乘法。(实际上,如果我们可以进行模2加法、模2减法,模2乘法,那它就足够了。)特别的是，对于x属于{ 0,1 },我们有AND(x,y)=xy,OR(x,y)= 1−(1−x)(1−y),和NOT(x)= 1−x。所以,获得完全同态加密方案,我们需要的是一个方案,可以作用于暗文进行加、减、和乘。

但一些使用算术表示或者电路表示的f一定是最有效的方法评估f么?事实上,一些功能,如二分查找,图灵机比随机存取机器需要更长的时间。在随机存取机器上,一个对t个元素的二分查找算法只需要“接触”O(logt)的输入。

这表明,如果数据是加密的,随机存取的加速效果不能工作。除非我们提前知道f和m1,…,mt之间的关系,算法Evaluatee(pk,f,c1,…,ct)必须接触的所有输入暗文,因此复杂度至少和输入的数量成线性关系。换句话说,如果Evaluatee(由于某种原因)不接触剩下一半暗文,这将泄漏剩下的消息——与f的计算无关——这个泄漏会与安全加密方案产生矛盾。虽然Evaluatee必须至少运行在线性时间t上,作为一个不可避免的成本,完成同态加密,权衡是可能的。如果我愿意解密——例如,在云计算环境中包含的文件,我希望是一个1%的数据,然后我可以帮助云减少100倍工作量。

另外一个使用固定电路表示f的就是输出的大小——例如，输出电路的大小——必须提前确定数量。例如,当我请求包含关键字的组合的所有我的文件,我还应该指定我想检索多少数据——例如,1 mb。从我的请求,云将为一个函数,生成一个电路输出的第一个mb的正确的文件,输出将会发生截断(如果太多我的数据满足我的要求),或全为0(如果太少满足)。这也是不可避免的。云没有办法可以避免截断或填充,除非它知道一些先验函数和我的数据之间的关系。

### 2.3 同态加密：安全

在安全方面,加密方案的最低要求是单向性:给定公钥pk和在pk下对未知的消息m进行加密的密文c,它应该是“很难”输出m。“很难”意味着任何算法或“攻击者”A在poly(namuta)运行时间有一个可以忽略不计的成功概率的选择正确的pk和m(即,它输出m的概率小于1/namuta^k，对于任何常数k)。

现在,我们通常需要一个加密方案具有更强的安全属性,称为语义安全,来应对选定的明文攻击(CPA)引用4:给定加密密文c加密了m0或者m1,攻击者很难确定,即使是允许选择m0或者m1。在这里,“很难”意味着,如果攻击者在多项式时间内猜测正确概率为1/2+ E,那么E就是所谓的优势,可以忽略不计。如果这个优势是不可忽视的,那么我们说(非正式)攻击者打破了语义安全的加密方案。

如果一个加密方案是具有确定性的——例如,如果只有一个密文加密一个给定消息,那么它不可能是语义安全的。攻击者可以很容易地判断是不是c加密m0,通过运行c0<-Encrypt(pk,m0)和看看c和c0是相同的。语义安全的加密方案必须是符合概率分布的,例如，必须有许多暗文对给定消息加密,且必须符合一个随机选择的概率分布。

一个可以证明加密方案是单向性或语义安全的方法是通过分解使得这个问题简单化。例如,如果有一个有效的算法将破解加密方案,该算法可以用来作为一个分解大数高效算法的子程序。然后,假设分解很难——例如,没有poly(namuta)-时间复杂度的算法可以分解因素namuta-位的大数,这意味着加密方案必须是很难破解的。

同态加密方案的语义安全是和普通加密方案的定义方式相同的,没有引用Evaluatee算法。如果我们设法证明还原——例如,一个破坏e的攻击算法可以被用来解决一个困难问题像分解大数,那么它是成立的,无论Evaluatee算法是否适用于大量的函数。

想要理解语义安全的力量,让我们重新审视我们的云计算应用程序。有时在云中存储加密的文件后,爱丽丝想要云检索有一定关键字组合的文件。假设在其收到指令进行回复时,云发送加密的前三个文件。云就不能看到这存储的前三个加密的文件么?如果这个方案是语义安全的，那么是不行的。尽管一些存储的暗文和发送的内容相同,但是云不能看到这个,因为语义安全保障了它们的安全,导致云很难分辨两个暗文是否加密了相同的内容。

直观地看,似乎Evaluatee算法应该会使得方案e容易破解,因为这额外的算法给了攻击者更多的权力。或者换用物理类比,有人会认为,最简单的方式进入通过手套箱,就是切开这个手套,手套越灵活,手套箱是越容易被破解,这表明,更具延展性的加密方案,容易被破解。这是有道理的。研究人员（引用18）表示,如果方案e是一个确定性的完全同态加密方案(或者更广泛地说,它很容易分辨两个暗文是不是加密相同的消息),那么方案e是可以在次指数时间内被破解的,在量子计算机上只需要多项式时间。所以,可塑性似乎削弱了确定性的安全方案。但是这些结果并不适用于语义安全的方案,比如我们的全同态加密方案。

### 2.4. 类比上的一些漏洞
同态加密的物理类比某些方面不是很好。例如,物理类比表明加密的消息分别在不同的“加密盒”,不能互动。当然,这种互动正是同态加密的目的。为了修复这个漏洞,我们可以想象,手套箱有一个单向插入槽像邮局所使用的邮件箱。然后,当消息到来时,可以被添加到相同加密盒中。(即使这个修复并不完全令人满意。)

另一个缺陷是,输出f(m1,…,mt)位数显然少于m1,…,mt,而类比中质量守恒定律规定盒子在工作完成后将存在尽可能多的材料。最后,在爱丽丝的珠宝店,即使一个工人不能从一个锁上的手套箱中提取材料,他可以很容易地分辨一个盒子是否包含一组特定的材料。手套箱没有提供“语义安全。”

## 3.有点同态加密方案
想要获得完全同态加密的方案,我们首先构造一种“有点”同态加密方案e,能够处理有限类允许函数。Evaluatee(pk,f,c1,…,ct)不适合太复杂的函数f。之后,我们将介绍使用这个有点同态加密方案e去获得完全同态加密方案。

### 3.1. 与此同时,在爱丽丝的珠宝店里
弄清楚如何使用手套箱锁后让她的工人来处理她的珍贵材料成漂亮的戒指和项链,爱丽丝与Acme手套箱公司定了一个订单。不幸的是,她收到有缺陷的手套箱。工人使用手套1分钟后,手套变的不灵活并且成为无用的了。但是一些高档的组装需要一个小时。爱丽丝起诉Acme,但是与此同时她很好奇:有方法我可以安全地使用这些有缺陷的盒子让工人组装甚至最复杂的作品么?

她注意到盒子,尽管有缺陷,但是有一个属性,可能是有用的。正如所料,他们有一个单向的插入插槽,像邮局邮件箱。但他们也足够灵活,可以将一个盒子放到另一个插槽。她想知道这个属性可能会发挥作用解决她的问题。

### 3.2. 我们的有点同态加密方案
我们的有点同态加密方案e,下面描述3它,非常简单。我们首先描述为一个对称加密方案。作为一个例子的参数设置,安全参数namuta,设置N=namuta,P=namuta^2和Q=namuta^5。

>此处一段公式

e的暗文接近p的倍数。我们称之为(c mod p)相关的噪声密文c。它是距离最近的p的倍数。解密有效,是因为噪音是m',和消息具有相同的奇偶校验信息。我们称之为新鲜的加密密文,因为它噪声很小。

这个方案同态效果如何呢?通过简单的加法、减法、或将暗文做为整数相乘,我们可以对底层的消息模2加、模2减、或模2乘。然而,并发症出现,因为这些操作会增加相关暗文的噪声。最终,噪声变得如此之大,解密不再可靠地返回正确的结果。

同态操作:

>此处公式

让我们检查Evaluatee产出的暗文是否正确解密。作为热身,让我们考虑Multe。让c = c1•c2,ci的噪音是m',和mi具有相同的奇偶校验信息。我们有

>公式

对于一些整数q'。只要噪声足够小,以至于| m1'•m2' | < p / 2,那么我们有

>公式

因此(c mod p) mod 2 = m1•m2。在3.3节，我们将考虑评估更复杂的函数。

到目前为止我们只描述了一个对称同态加密方案。把它变成一个公钥方案简单,但增加了一些复杂度。和之前一样,密钥是p。公钥由一个整数列表组成,本质上是零的加密。列表长度为namuta的多项式。想要加密一位数m,密文c(基本上)是m加上公钥下的暗文的随机子集和。如果这些暗文有很小的噪音,由此产生的密文也将有很小噪音,解密将正常工作:(c mod p) mod 2 = m ,结果和以前一样。

### 3.3 它的同态效果如何？
允许函数的条件是什么,我们的同态加密方案可以处理吗?

要回答这个问题,我们需要分析噪声的增长随着我们对暗文加和乘。Encrypte输出一个新鲜的密文,噪音小,最多N比特。当我们Adde,Sube,或者Multe密文,输出密文变得噪音更大了。乘法往往比加法和减法会增加更多噪音。特别的是,暗文c<-c1*c2的有大约(k1+k2)比特噪音。

当我们执行许多Adde、Sube和Multe操作,电路表示函数f会怎样 ?类似于上面我们看到的乘法,我们有

>公式

对于一些整数问q',其中mt'是噪声相关的ci。如果| f __(m¢1,…,m¢t)| < p / 2,那么(f __(c1,…,ct) mod p)= f __(m¢1,…,m¢t)。如果我们把这一结果模2减,我们获得正确的结果:f(m1,…,mt)。

简而言之,方案e可以处理的那些函数| f __(a1,…)|总是小于p / 2,如果所有的ai都是最多N比特。

方案e已经很强大。作为一个例子,它可以处理一个t变量d阶的初等对称多项式,只要2^Nd•(t d)< p / 2,这是正确的(大约)当d < p / (N•logt)。我们的建议参数,这个阶数可以相当大:namuta / (logt)= omiga(namuta / lognamuta),方案e可以评估如此高阶的多项式使其足够“同态”并应于于很多应用程序。例如,当f是一个高度并行的函数——一个基本的关键字搜索,这种情况下f具有相当低的阶数。

### 3.4 语义安全和近似GCD问题
欧几里得表明,给定两个整数x1和x2,很容易计算其最大公约数(gcd)。但假设x1 = s1 + p•q1和x2 = s2 + p•q2 都是p的倍数的近似值,s1和s2远小于p,p只是一个近似gcd,是否仍旧可以十分有效地计算p——例如,在x1和x2位数的多项式时间内。据我们所知这是不可行的。

事实上,如果我们取样si,p和qi,分别对应namuta,namuta^2,和namuta^5位数(类似于我们的方案e),然后近似gcd问题似乎依然困难即使我们给出许多随机样本xi= si + p•qi。对于这些参数,已知的攻击包括那些使用持续分数和同步丢番图估计的攻击方式都需要花费指数namuta的时间。

此外,我们可以减少近似gcd问题为我们的有点同态加密方案的安全性。我们可以证明,攻击者不能有效地打破我们的语义安全加密方案,除非近似gcd问题是很容易解决的。

## 4.可自举的加密

### 4.1 爱丽丝的发现时刻

有一天夜里,爱丽丝梦到了自己拥有巨大财富,洞穴堆满了白银,黄金,钻石。然后,一个巨大的龙吞噬财富和同时开始吃自己的尾巴!她醒来的感觉很平静。当她试图理解她的梦时,她意识到她的问题的解决方案。她知道如何使用有缺陷的箱子去安全地委托即使是最复杂的部分的组装!

之前,她给一个工人一个手套箱,箱#1,包含原材料。但她也给了他几个额外的手套箱,箱#2包含箱#1的钥匙、箱#3包含箱#2的钥匙等等。组装一个错综复杂的设计,工人操纵箱#1中的材料,直到手套不灵活。然后,他把箱#1放到箱#2里,后者箱#2已经包含一个箱#1的钥匙。使用手套箱#2,他用钥匙打开箱#1,提取部分组装的装饰品,并继续组装,直到其手套变得不灵活。然后他把箱#2放进箱#3里,如此反复。当工人最终完成他的组装,他最后使用的是箱#n,他把这个箱子交给爱丽丝。

当然,爱丽丝所观察到的,这种方法并不奏效,除非工人在箱#(i+1)里可以打开箱#i,并且还有时间去进行一点点组装,在手套箱#(i + 1)变得不灵活之前。但只要解锁操作(加一点装配工作)需要少于一分钟,只要她有足够多的有缺陷的手套箱,那就可以组装任何原材料,不管多么复杂!

### 4.2. 理想解密
在类比中,缺陷手套箱代表我们的有点同态加密方案,它可以执行加、减和相乘操作。虽然可以处理有限的允许函数,但是噪音会不断增大直到不能再处理。我们要做的就是使用这个有点同态加密方案构建一个完全同态加密方案。

和之前一样,含有珍贵材料的箱#1代表暗文对初始数据进行加密。箱#(i + 1)带有箱#i的钥匙代表一个加密后的解密秘钥——例如,ski在公钥pki+1下的加密结果。

在类比中,爱丽丝发现只有一件事是她的员工真正需要用手套箱在不到1分钟之内完成的,除了对材料执行一块很小的操作:从箱#（i+1）中打开箱#i并提取原材料。将会只有一个函数,是我们的方案e真的需要能够处理,有一点点的空间剩下来执行一个加、减,或相乘:解密函数(如打开“加密盒”)。

如果方案e拥有自我参照属性以至于能够处理自己的解密函数(是由一个门增强),我们说它是自举的。正如我们将介绍的,如果方案e是自举的,那么可以使用方案e来构建一个完全同态加密方案e。

### 4.3
